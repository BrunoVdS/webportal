<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Pi Download Server</title>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <div class="theme-toggle">
      <button type="button" id="theme-toggle" aria-pressed="false" aria-label="Toggle night vision mode">
        Enable night vision
      </button>
    </div>
    <main>
      <h1>Welcome to the Raspberry Pi download server</h1>
      <p>Files: <a href="/files/">/files/</a></p>
    </main>

    <script>
      (function () {
        const THEME_KEY = "preferredTheme";
        const body = document.body;
        const toggleButton = document.getElementById("theme-toggle");

        function applyTheme(theme) {
          const isNightVision = theme === "night-vision";
          body.classList.toggle("night-vision", isNightVision);
          toggleButton.textContent = isNightVision ? "Disable night vision" : "Enable night vision";
          toggleButton.setAttribute("aria-pressed", String(isNightVision));
        }

        function getStoredTheme() {
          try {
            return localStorage.getItem(THEME_KEY);
          } catch (error) {
            return null;
          }
        }

        function storeTheme(theme) {
          try {
            if (theme === "night-vision") {
              localStorage.setItem(THEME_KEY, theme);
            } else {
              localStorage.removeItem(THEME_KEY);
            }
          } catch (error) {
            // Ignore storage errors (e.g., private browsing)
          }
        }

        let currentTheme = getStoredTheme() === "night-vision" ? "night-vision" : "standard";
        applyTheme(currentTheme);

        toggleButton.addEventListener("click", () => {
          currentTheme = currentTheme === "night-vision" ? "standard" : "night-vision";
          applyTheme(currentTheme);
          storeTheme(currentTheme);
        });
      })();
    </script>
  </body>
</html>
